# ============================================
# NGINX Cache Configuration for Performance
# Score improvement: 820 KB savings on repeat visits
# ============================================

# Add this inside your server { } block

# ============================================
# 1. STATIC ASSETS - Long cache (1 year)
# ============================================
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|eot|otf)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
    
    # Enable CORS for fonts
    add_header Access-Control-Allow-Origin "*";
    
    # Security headers
    add_header X-Content-Type-Options "nosniff";
}

# ============================================
# 2. HTML FILES - No cache
# ============================================
location ~* \.html$ {
    expires -1;
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
    add_header Pragma "no-cache";
}

# ============================================
# 3. API RESPONSES - Brief cache (1 minute)
# ============================================
location /api/ {
    expires 1m;
    add_header Cache-Control "public, max-age=60";
    
    # Proxy settings (if using Node.js backend)
    proxy_pass http://localhost:3001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
}

# ============================================
# 4. GZIP COMPRESSION
# ============================================
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types 
    text/plain 
    text/css 
    text/xml 
    text/javascript 
    application/json 
    application/javascript 
    application/xml+rss 
    application/rss+xml 
    font/truetype 
    font/opentype 
    application/vnd.ms-fontobject 
    image/svg+xml;
gzip_min_length 1000;
gzip_disable "msie6";

# ============================================
# 5. BROTLI COMPRESSION (if module available)
# ============================================
# Install: sudo apt install nginx-module-brotli
# Then uncomment:
# load_module modules/ngx_http_brotli_filter_module.so;
# load_module modules/ngx_http_brotli_static_module.so;

# brotli on;
# brotli_comp_level 6;
# brotli_types 
#     text/plain 
#     text/css 
#     text/xml 
#     text/javascript 
#     application/json 
#     application/javascript 
#     application/xml+rss 
#     application/rss+xml 
#     font/truetype 
#     font/opentype 
#     application/vnd.ms-fontobject 
#     image/svg+xml;

# ============================================
# 6. SECURITY HEADERS
# ============================================
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# ============================================
# COMPLETE EXAMPLE SERVER BLOCK
# ============================================
# Copy this to /etc/nginx/sites-available/internationaltijarat.com
# Then: sudo ln -s /etc/nginx/sites-available/internationaltijarat.com /etc/nginx/sites-enabled/
# Then: sudo nginx -t && sudo systemctl reload nginx

# server {
#     listen 80;
#     listen [::]:80;
#     server_name internationaltijarat.com www.internationaltijarat.com;
#     
#     # Redirect to HTTPS
#     return 301 https://$server_name$request_uri;
# }
# 
# server {
#     listen 443 ssl http2;
#     listen [::]:443 ssl http2;
#     server_name internationaltijarat.com www.internationaltijarat.com;
#     
#     # SSL certificates (from Let's Encrypt)
#     ssl_certificate /etc/letsencrypt/live/internationaltijarat.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/internationaltijarat.com/privkey.pem;
#     
#     # Root directory
#     root /var/www/internationaltijarat/frontend/dist;
#     index index.html;
#     
#     # Include all cache rules from above here
#     
#     # SPA fallback
#     location / {
#         try_files $uri $uri/ /index.html;
#     }
# }
